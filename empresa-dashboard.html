<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Empresa – SmartDevs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Bem-vindo, Empresa!</h1>
  </header>

  <section id="historico-compras">
    <h2>Histórico de Compras</h2>
    <table id="tabela-compras">
      <thead>
        <tr>
          <th>Projeto</th>
          <th>Valor Total</th>
          <th>Comissão Plataforma</th>
          <th>Status Pagamento</th>
          <th>Data</th>
        </tr>
      </thead>
      <tbody>
        <!-- Compras carregadas via JS -->
      </tbody>
    </table>
  </section>

  <script src="auth.js"></script>
  <script src="main.js"></script>
  <script>
    const tabela = document.getElementById("tabela-compras").querySelector("tbody");

    async function carregarCompras() {
      const { data, error } = await supabase
        .from("vendas")
        .select(`
          id,
          projeto_id,
          projetos(titulo),
          valor_total,
          comissao,
          status_pagamento,
          data_venda
        `)
        .eq("empresa_id", supabase.auth.user().id);

      if (error) return alert("Erro ao carregar compras: " + error.message);

      tabela.innerHTML = "";

      data.forEach(v => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${v.projetos.titulo}</td>
          <td>R$ ${parseFloat(v.valor_total).toFixed(2)}</td>
          <td>R$ ${parseFloat(v.comissao).toFixed(2)}</td>
          <td>${v.status_pagamento}</td>
          <td>${new Date(v.data_venda).toLocaleString()}</td>
        `;
        tabela.appendChild(tr);
      });
    }

    // Inicializa
    carregarCompras();
  </script>
</body>
</html>
